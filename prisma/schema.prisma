generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model logs {
  id          Int      @id @default(autoincrement())
  action      String   @db.VarChar
  table       String   @db.VarChar
  user        String   @db.VarChar
  date        DateTime @default(now()) @db.Timestamptz(6)
  description String   @db.VarChar
  data        String   @db.VarChar
}

model users {
  id                       Int                        @id @default(autoincrement())
  username                 String                     @unique @db.VarChar
  name                     String?                    @db.VarChar
  email                    String                     @unique @db.VarChar
  password                 String                     @db.VarChar
  active                   Boolean                    @default(true)
  createdAt                DateTime                   @default(now()) @db.Timestamptz(6)
  createdBy                String                     @db.VarChar
  updatedBy                String?                    @db.VarChar
  updatedAt                DateTime?                  @updatedAt @db.Timestamptz(6)
  role                     String                     @default("seller")
  connectionControlHistory connectionControlHistory[]
}

model appliances {
  id             Int                @id @default(autoincrement())
  customerId     Int?
  productId      Int
  active         Boolean            @default(true)
  createdAt      DateTime           @default(now()) @db.Timestamptz(6)
  createdBy      String             @db.VarChar
  dealerId       Int?
  serialNo       String?            @db.VarChar
  supplierId     Int?
  updatedBy      String?            @db.VarChar
  boughtAt       DateTime?          @db.Date
  soldAt         DateTime?          @db.Date
  predecessorId  Int?               @unique
  updatedAt      DateTime?          @updatedAt @db.Timestamptz(6)
  deleted        Boolean            @default(false)
  subDealerId    Int?
  note           String?            @db.VarChar
  isDemo         Boolean            @default(false)
  cusName        String?            @db.VarChar
  history        applianceHistory[]
  customer       currents?          @relation("Customer", fields: [customerId], references: [id])
  dealer         currents?          @relation("Dealer", fields: [dealerId], references: [id])
  predecessor    appliances?        @relation("ApplienceHistory", fields: [predecessorId], references: [id])
  successor      appliances?        @relation("ApplienceHistory")
  product        products           @relation(fields: [productId], references: [id])
  subDealer      currents?          @relation("SubDealer", fields: [subDealerId], references: [id])
  supplier       currents?          @relation("Supplier", fields: [supplierId], references: [id])
  licenseHistory licenseHistory[]
  licenses       licenses[]
}

model applianceHistory {
  id          Int        @id @default(autoincrement())
  customerId  Int?
  cusName     String?    @db.VarChar
  applianceId Int
  boughtAt    DateTime?  @db.Date
  soldAt      DateTime?  @db.Date
  createdBy   String     @db.VarChar
  createdAt   DateTime   @default(now()) @db.Timestamptz(6)
  updatedBy   String?    @db.VarChar
  updatedAt   DateTime?  @updatedAt @db.Timestamptz(6)
  appliance   appliances @relation(fields: [applianceId], references: [id])
  customer    currents?  @relation(fields: [customerId], references: [id])
}

model licenses {
  id            Int              @id @default(autoincrement())
  active        Boolean          @default(true)
  startDate     DateTime?        @db.Date
  expiryDate    DateTime?        @db.Date
  createdBy     String           @db.VarChar
  createdAt     DateTime         @default(now()) @db.Timestamptz(6)
  updatedBy     String?          @db.VarChar
  boughtAt      DateTime?        @db.Date
  soldAt        DateTime?        @db.Date
  dealerId      Int?
  licenseTypeId Int
  supplierId    Int?
  updatedAt     DateTime?        @updatedAt @db.Timestamptz(6)
  customerId    Int?
  deleted       Boolean          @default(false)
  serialNo      String?          @db.VarChar
  applianceId   Int?
  subDealerId   Int?
  boughtTypeId  Int?
  note          String?          @db.VarChar
  orderedAt     DateTime?        @db.Date
  appSerialNo   String?          @db.VarChar
  productId     Int?
  cusName       String?          @db.VarChar
  isLost        Boolean          @default(false)
  isPassive     Boolean          @default(false)
  history       licenseHistory[]
  appliance     appliances?      @relation(fields: [applianceId], references: [id])
  boughtType    boughtTypes?     @relation(fields: [boughtTypeId], references: [id])
  customer      currents?        @relation("Customer", fields: [customerId], references: [id])
  dealer        currents?        @relation("Dealer", fields: [dealerId], references: [id])
  licenseType   licenseTypes     @relation(fields: [licenseTypeId], references: [id])
  product       products?        @relation(fields: [productId], references: [id])
  subDealer     currents?        @relation("SubDealer", fields: [subDealerId], references: [id])
  supplier      currents?        @relation("Supplier", fields: [supplierId], references: [id])
}

model licenseHistory {
  id            Int          @id @default(autoincrement())
  licenseId     Int
  serialNo      String?      @db.VarChar
  startDate     DateTime?    @db.Date
  expiryDate    DateTime?    @db.Date
  licenseTypeId Int
  boughtTypeId  Int?
  createdBy     String       @db.VarChar
  createdAt     DateTime     @default(now()) @db.Timestamptz(6)
  updatedBy     String?      @db.VarChar
  updatedAt     DateTime?    @updatedAt @db.Timestamptz(6)
  dealerId      Int?
  subDealerId   Int?
  supplierId    Int?
  appSerialNo   String?      @db.VarChar
  applianceId   Int?
  boughtAt      DateTime?    @db.Date
  note          String?      @db.VarChar
  orderedAt     DateTime?    @db.Date
  productId     Int?
  soldAt        DateTime?    @db.Date
  appliance     appliances?  @relation(fields: [applianceId], references: [id])
  boughtType    boughtTypes? @relation(fields: [boughtTypeId], references: [id])
  dealer        currents?    @relation("Dealer", fields: [dealerId], references: [id])
  license       licenses     @relation(fields: [licenseId], references: [id])
  licenseType   licenseTypes @relation(fields: [licenseTypeId], references: [id])
  product       products?    @relation(fields: [productId], references: [id])
  subDealer     currents?    @relation("SubDealer", fields: [subDealerId], references: [id])
  supplier      currents?    @relation("Supplier", fields: [supplierId], references: [id])
}

model projects {
  id            Int           @id @default(autoincrement())
  active        Boolean       @default(true)
  customerId    Int
  dealerId      Int?
  productId     Int?
  licenseTypeId Int?
  date          DateTime      @db.Date
  createdAt     DateTime      @default(now()) @db.Timestamptz(6)
  createdBy     String        @db.VarChar
  updatedBy     String?       @db.VarChar
  updatedAt     DateTime?     @updatedAt @db.Timestamptz(6)
  note          String?       @db.VarChar
  status        String?       @default("active") @db.VarChar
  customer      currents      @relation("Customer", fields: [customerId], references: [id])
  dealer        currents?     @relation("Dealer", fields: [dealerId], references: [id])
  licenseType   licenseTypes? @relation(fields: [licenseTypeId], references: [id])
  product       products?     @relation(fields: [productId], references: [id])
}

model connections {
  id             Int                        @id @default(autoincrement())
  login          String?                    @db.VarChar
  password       String?                    @db.VarChar
  note           String?                    @db.VarChar
  createdAt      DateTime                   @default(now()) @db.Timestamptz(6)
  createdBy      String                     @db.VarChar
  updatedBy      String?                    @db.VarChar
  ip             String?                    @db.VarChar
  updatedAt      DateTime?                  @updatedAt @db.Timestamptz(6)
  customerId     Int?
  brandId        Int?
  controlled     Boolean?                   @default(false)
  controlHistory connectionControlHistory[]
  brand          brands?                    @relation(fields: [brandId], references: [id])
  customer       currents?                  @relation(fields: [customerId], references: [id])
}

model connectionControlHistory {
  id           Int         @id @default(autoincrement())
  connectionId Int
  userId       Int
  createdAt    DateTime    @default(now()) @db.Timestamptz(6)
  createdBy    String      @db.VarChar
  connection   connections @relation(fields: [connectionId], references: [id])
  user         users       @relation(fields: [userId], references: [id])
}

model brands {
  id           Int            @id @default(autoincrement())
  active       Boolean        @default(true)
  name         String         @db.VarChar
  createdAt    DateTime       @default(now()) @db.Timestamptz(6)
  createdBy    String         @db.VarChar
  updatedAt    DateTime?      @updatedAt @db.Timestamptz(6)
  updatedBy    String?        @db.VarChar
  connections  connections[]
  licenseTypes licenseTypes[]
  products     products[]
}

model products {
  id             Int              @id @default(autoincrement())
  active         Boolean          @default(true)
  createdAt      DateTime         @default(now()) @db.Timestamptz(6)
  createdBy      String           @db.VarChar
  model          String           @db.VarChar
  updatedBy      String?          @db.VarChar
  updatedAt      DateTime?        @updatedAt @db.Timestamptz(6)
  brandId        Int?
  productTypeId  Int?
  appliances     appliances[]
  licenseHistory licenseHistory[]
  licenses       licenses[]
  brand          brands?          @relation(fields: [brandId], references: [id])
  productType    productTypes?    @relation(fields: [productTypeId], references: [id])
  projects       projects[]
}

model productTypes {
  id        Int        @id @default(autoincrement())
  active    Boolean    @default(true)
  type      String     @db.VarChar
  createdAt DateTime   @default(now()) @db.Timestamptz(6)
  createdBy String     @db.VarChar
  updatedAt DateTime?  @updatedAt @db.Timestamptz(6)
  updatedBy String?    @db.VarChar
  products  products[]
}

model licenseTypes {
  id             Int              @id @default(autoincrement())
  active         Boolean          @default(true)
  duration       Int?
  type           String           @db.VarChar
  price          Decimal?         @db.Decimal(9, 2)
  createdAt      DateTime         @default(now()) @db.Timestamptz(6)
  createdBy      String           @db.VarChar
  updatedAt      DateTime?        @updatedAt @db.Timestamptz(6)
  updatedBy      String?          @db.VarChar
  brandId        Int?
  licenseHistory licenseHistory[]
  brand          brands?          @relation(fields: [brandId], references: [id])
  licenses       licenses[]
  projects       projects[]
}

model boughtTypes {
  id             Int              @id @default(autoincrement())
  active         Boolean          @default(true)
  type           String           @db.VarChar
  createdAt      DateTime         @default(now()) @db.Timestamptz(6)
  createdBy      String           @db.VarChar
  updatedAt      DateTime?        @updatedAt @db.Timestamptz(6)
  updatedBy      String?          @db.VarChar
  licenseHistory licenseHistory[]
  licenses       licenses[]
}

model currents {
  id                      Int                 @id @default(autoincrement())
  active                  Boolean             @default(true)
  type                    CurrentType         @default(customer)
  name                    String              @db.VarChar
  phone                   String?             @db.VarChar
  email                   String?             @db.VarChar
  address                 String?             @db.VarChar
  city                    String?             @db.VarChar
  taxOffice               String?             @db.VarChar
  taxNo                   String?             @db.VarChar
  createdAt               DateTime            @default(now()) @db.Timestamptz(6)
  createdBy               String              @db.VarChar
  updatedBy               String?             @db.VarChar
  updatedAt               DateTime?           @updatedAt @db.Timestamptz(6)
  paymentPlan             String?             @db.VarChar
  paymentNumber           String?             @db.VarChar
  authorizedName          String?             @db.VarChar
  authorizedTitle         String?             @db.VarChar
  addresses               addresses[]
  applianceHistory        applianceHistory[]
  customerAppliances      appliances[]        @relation("Customer")
  dealerAppliances        appliances[]        @relation("Dealer")
  subDealerAppliances     appliances[]        @relation("SubDealer")
  supplierAppliances      appliances[]        @relation("Supplier")
  authorizedPersons       authorizedPersons[]
  connections             connections[]
  dealerLicenseHistory    licenseHistory[]    @relation("Dealer")
  subDealerLicenseHistory licenseHistory[]    @relation("SubDealer")
  supplierLicenseHistory  licenseHistory[]    @relation("Supplier")
  customerLicenses        licenses[]          @relation("Customer")
  dealerLicenses          licenses[]          @relation("Dealer")
  subDealerLicenses       licenses[]          @relation("SubDealer")
  supplierLicenses        licenses[]          @relation("Supplier")
  customerProjects        projects[]          @relation("Customer")
  dealerProjects          projects[]          @relation("Dealer")
}

model authorizedPersons {
  id        Int       @id @default(autoincrement())
  currentId Int
  name      String    @db.VarChar
  isMain    Boolean   @default(false)
  title     String?   @db.VarChar
  phone     String?   @db.VarChar
  email     String?   @db.VarChar
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  createdBy String    @db.VarChar
  updatedBy String?   @db.VarChar
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  current   currents  @relation(fields: [currentId], references: [id], onDelete: Cascade)
}

model addresses {
  id        Int       @id @default(autoincrement())
  currentId Int
  name      String    @db.VarChar
  address   String    @db.VarChar
  city      String?   @db.VarChar
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  createdBy String    @db.VarChar
  updatedBy String?   @db.VarChar
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  current   currents  @relation(fields: [currentId], references: [id], onDelete: Cascade)
}

view vAppliances {
  id            Int       @unique
  status        String?
  serialNo      String?   @db.VarChar
  boughtAt      DateTime? @db.Date
  soldAt        DateTime? @db.Date
  createdBy     String?   @db.VarChar
  createdAt     DateTime? @db.Timestamptz(6)
  updatedBy     String?   @db.VarChar
  updatedAt     DateTime? @db.Timestamptz(6)
  deleted       Boolean?
  isDemo        Boolean?
  productId     Int?
  product       String?
  productModel  String?   @db.VarChar
  productBrand  String?   @db.VarChar
  customerName  String?   @db.VarChar
  dealerName    String?   @db.VarChar
  subDealerName String?   @db.VarChar
  supplierName  String?   @db.VarChar
}

view vLicenses {
  id                Int       @unique
  status            String?
  serialNo          String?   @db.VarChar
  startDate         DateTime? @db.Date
  expiryDate        DateTime? @db.Date
  boughtAt          DateTime? @db.Date
  soldAt            DateTime? @db.Date
  orderedAt         DateTime? @db.Date
  createdBy         String?   @db.VarChar
  createdAt         DateTime? @db.Timestamptz(6)
  updatedBy         String?   @db.VarChar
  updatedAt         DateTime? @db.Timestamptz(6)
  deleted           Boolean?
  appSerialNo       String?   @db.VarChar
  applianceSerialNo String?   @db.VarChar
  product           String?
  productModel      String?   @db.VarChar
  productBrand      String?   @db.VarChar
  licenseType       String?
  boughtType        String?   @db.VarChar
  customerName      String?   @db.VarChar
  dealerName        String?   @db.VarChar
  subDealerName     String?   @db.VarChar
  supplierName      String?   @db.VarChar
  expiryStatus      String?
  isLost            Boolean?
  isPassive         Boolean?
}

view vConnections {
  id               Int       @unique
  ip               String?   @db.VarChar
  login            String?   @db.VarChar
  password         String?   @db.VarChar
  note             String?   @db.VarChar
  createdBy        String?   @db.VarChar
  createdAt        DateTime? @db.Timestamptz(6)
  updatedBy        String?   @db.VarChar
  updatedAt        DateTime? @db.Timestamptz(6)
  customerName     String?   @db.VarChar
  brandName        String?   @db.VarChar
  controlled       Boolean?
  lastControlledAt DateTime? @db.Timestamptz(6)
}

view vProjects {
  id              Int       @unique
  date            DateTime? @db.Date
  status          String?   @db.VarChar
  createdBy       String?   @db.VarChar
  createdAt       DateTime? @db.Timestamptz(6)
  updatedBy       String?   @db.VarChar
  updatedAt       DateTime? @db.Timestamptz(6)
  customerName    String?   @db.VarChar
  dealerName      String?   @db.VarChar
  productModel    String?   @db.VarChar
  productBrand    String?   @db.VarChar
  licenseType     String?   @db.VarChar
  licenseDuration Int?
}

view vApplianceCounts {
  id          Int     @unique
  stockCount  BigInt?
  orderCount  BigInt?
  activeCount BigInt?
}

view vLicenseCounts {
  id             Int     @unique
  stockCount     BigInt?
  orderCount     BigInt?
  waitingCount   BigInt?
  activeCount    BigInt?
  lostCount      BigInt?
  passiveCount   BigInt?
  undefinedCount BigInt?
  endedCount     BigInt?
  endingCount    BigInt?
  continuesCount BigInt?
}

view vProjectCounts {
  id          Int     @unique
  activeCount BigInt?
  winCount    BigInt?
  lostCount   BigInt?
}

view vLicenseTypes {
  id        Int       @unique
  active    Boolean?
  duration  Int?
  type      String?   @db.VarChar
  price     Decimal?  @db.Decimal(9, 2)
  brandId   Int?
  createdBy String?   @db.VarChar
  createdAt DateTime? @db.Timestamptz(6)
  updatedBy String?   @db.VarChar
  updatedAt DateTime? @db.Timestamptz(6)
  brandName String?   @db.VarChar
}

view vProducts {
  id            Int       @unique
  active        Boolean?
  model         String?   @db.VarChar
  brandId       Int?
  productTypeId Int?
  createdBy     String?   @db.VarChar
  createdAt     DateTime? @db.Timestamptz(6)
  updatedBy     String?   @db.VarChar
  updatedAt     DateTime? @db.Timestamptz(6)
  brandName     String?   @db.VarChar
  productType   String?   @db.VarChar
}

enum CurrentType {
  customer
  dealer
  supplier
}
